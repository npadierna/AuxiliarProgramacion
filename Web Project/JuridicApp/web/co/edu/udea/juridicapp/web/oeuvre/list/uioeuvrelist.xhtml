<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd" >

<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:c="http://java.sun.com/jsp/jstl/core" >

    <h:form id="mainForm" >
        <p:growl id="growl" showDetail="true" ></p:growl>

        <center>
            <p:dataTable
                emptyMessage="No se han encontrado ningún tipo de Obras."
                id="mainTable"
                paginator="true" 
                paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                rowKey="#{authorOeuvre.key}"
                rows="10" rowsPerPageTemplate="10,15,30"
                selection="#{oeuvreListBean.selectedAuthorOeuvre}"
                selectionMode="single"
                style="width:98%; font-size:13px;"
                value="#{oeuvreListBean.authorOeuvres}"
                var="authorOeuvre" > 

                <f:facet name="header" >
                    Listado De Obras
                </f:facet>

                <p:column
                    filterBy="#{authorOeuvre.oeuvreType.oeuvre.title}"
                    filterMatchMode="contains"
                    style="font-size:15px;" >
                    <f:facet id="issue" name="header" >
                        <h:outputText value="Nombre De La Obra" >
                        </h:outputText>
                    </f:facet>
                    <h:outputText
                        style="font-size:13px;"
                        value="#{authorOeuvre.oeuvreType.oeuvre.title}" >
                    </h:outputText>
                </p:column>

                <p:column
                    sortBy="#{authorOeuvre.delivering}"
                    style="font-size:15px; text-align: center;" >
                    <f:facet id="year" name="header" >
                        <h:outputText
                            value="Fecha Entrega" >
                        </h:outputText>  
                    </f:facet>
                    <h:outputText
                        style="font-size:13px;"
                        value="#{authorOeuvre.delivering}" >
                    </h:outputText>
                </p:column>

                <p:column
                    filterBy="#{authorOeuvre.authorOeuvrePK.oeuvreTypeName}"
                    filterMatchMode="exact"
                    filterOptions="#{typeBean.typesSelectItems}"
                    sortBy="#{authorOeuvre.authorOeuvrePK.oeuvreTypeName}"
                    style="font-size:15px;" >
                    <f:facet id="type" name="header">  
                        <h:outputText value="Tipo" >
                        </h:outputText>  
                    </f:facet>
                    <h:outputText
                        style="font-size:13px;"
                        value="#{authorOeuvre.authorOeuvrePK.oeuvreTypeName}" >
                    </h:outputText>
                </p:column>

                <p:column
                    filterBy="#{authorOeuvre.author.people.lastNames} #{authorOeuvre.author.people.firstNames}"
                    filterMatchMode="contains"
                    sortBy="#{authorOeuvre.author.people.lastNames} #{authorOeuvre.author.people.firstNames}"
                    style="font-size:15px;" >
                    <f:facet id="author" name="header" >
                        <h:outputText value="Autor" >
                        </h:outputText>  
                    </f:facet>
                    <h:outputText
                        style="font-size:13px;"
                        value="#{authorOeuvre.author.people.lastNames} #{authorOeuvre.author.people.firstNames}" >
                    </h:outputText>
                </p:column>

                <p:column 
                    filterBy="#{authorOeuvre.contract1.id}"
                    filterMatchMode="contains"
                    sortBy="#{authorOeuvre.contract1.id}"
                    style="font-size:15px; text-align: center;" >
                    <f:facet id="contract" name="header" > 
                        <h:outputText value="N° Contrato" >
                        </h:outputText>
                    </f:facet>
                    <h:outputText
                        value="#{authorOeuvre.contract1.id}"
                        style="font-size:13px;" >
                    </h:outputText>
                </p:column>

                <p:column
                    filterBy="#{authorOeuvre.acquisition1.type}"
                    filterOptions="#{acquisitionBean.acquisitionsSelectItems}"
                    filterMatchMode="exact"
                    sortBy="#{authorOeuvre.acquisition1.type}"
                    style="font-size:15px; text-align: center;" >
                    <f:facet id="isbn" name="header" > 
                        <h:outputText value="Acquisición" >
                        </h:outputText>
                    </f:facet>
                    <h:outputText
                        style="font-size:13px;"
                        value="#{authorOeuvre.acquisition1.type}" >
                    </h:outputText>                    
                </p:column>

                <p:column style="font-size:15px; text-align: center;" >
                    <f:facet id="isbn" name="header" > 
                        <h:outputText value="ISBN" >
                        </h:outputText>
                    </f:facet>
                    <h:outputText
                        style="font-size:13px;"
                        value="#{authorOeuvre.isbn}" >
                    </h:outputText>
                </p:column>

                <p:column
                    sortBy="#{authorOeuvre.dnda.number}"
                    style="font-size:15px; text-align: center;" >
                    <f:facet id="dnda" name="header" >
                        <h:outputText value="DNDA" >
                        </h:outputText>  
                    </f:facet>
                    <h:outputText
                        style="font-size:13px;"
                        value="#{authorOeuvre.dnda.number}" >
                    </h:outputText>
                </p:column>

                <p:column
                    filterBy="#{authorOeuvre.supportType.type}"
                    filterMatchMode="exact"
                    filterOptions="#{supportBean.supportsSelectItems}"
                    sortBy="#{authorOeuvre.supportType.type}"
                    style="font-size:15px; text-align: center;" >
                    <f:facet id="support" name="header" >
                        <h:outputText value="Soporte" >
                        </h:outputText>  
                    </f:facet>
                    <h:outputText
                        style="font-size:13px;"
                        value="#{authorOeuvre.supportType.type}" >
                    </h:outputText>
                </p:column>

                <f:facet id="button" name="footer" >
                    <p:commandButton
                        action="#{oeuvreSelectorBean.onSelectedAuthorOeuvre(oeuvreListBean.selectedAuthorOeuvre)}"
                        icon="ui-icon-search"
                        id="viewDetailsButton"
                        oncomplete="onSelectedAuthorOeuvreRequest(xhr, status, args)"
                        update=":mainForm:growl"
                        value="Ver más detalles" >
                    </p:commandButton>

                    <c:if
                        test="${loginClientBean.loggedClient.title.title == 'Gestor De Contratos'}" >
                        <p:commandButton action="#{contractBean.onViewContractForAuthorOeuvre(oeuvreListBean.selectedAuthorOeuvre)}"
                                         icon="ui-icon-person"
                                         id="createAuthorButton"
                                         onclick="location.href = '/Juridicapp/faces/co/edu/udea/juridicapp/web/admin/creator/authorscreator.xhtml';"                                  
                                         value="Crear Nuevo Autor" >
                        </p:commandButton>
                    </c:if>

                    <p:commandButton
                        action="#{contractBean.onViewContractForAuthorOeuvre(oeuvreListBean.selectedAuthorOeuvre)}"
                        icon="ui-icon-newwin"
                        id="viewContractButton"
                        oncomplete="onViewContractRequest(xhr, status, args)"                                  
                        value="Ver contrato" >
                    </p:commandButton>

                    <p:commandButton
                        action="#{authorOeuvreFileBean.onSelectedAuthorOeuvre(oeuvreListBean.selectedAuthorOeuvre)}"
                        icon="ui-icon-document"
                        id="viewProductsFilesButton"
                        oncomplete="onViewProductRequest(xhr,status,args)"
                        value="Ver producto" >
                    </p:commandButton>
                </f:facet>
            </p:dataTable>
        </center>

        <p:spacer width="15px" ></p:spacer>

        <h:panelGrid columns="2" >
            <p:panel header="Exportar todas las Obras" >
                <center>
                    <h:commandLink>
                        <p:graphicImage
                            height="30px" width="30px"
                            value="/faces/co/edu/udea/juridicapp/util/images/download_excel.png" >
                        </p:graphicImage>  
                        <p:dataExporter
                            encoding="UTF-8" fileName="ObrasCompletas"
                            target="mainTable" type="xls" >
                        </p:dataExporter>
                    </h:commandLink>

                    <p:spacer width="25px" ></p:spacer>

                    <h:commandLink>  
                        <p:graphicImage
                            height="30px" width="30px"
                            value="/faces/co/edu/udea/juridicapp/util/images/download_pdf.png" >
                        </p:graphicImage>  
                        <p:dataExporter
                            encoding="UTF-8" fileName="ObrasCompletas"
                            preProcessor="#{oeuvreListBean.preProcessForPDFFile}"
                            target="mainTable" type="pdf" >
                        </p:dataExporter>
                    </h:commandLink>
                </center>
            </p:panel>

            <p:panel header="Exportar esta vista" >
                <center>
                    <h:commandLink>
                        <p:graphicImage
                            height="30px" width="30px"
                            value="/faces/co/edu/udea/juridicapp/util/images/download_excel.png" > 
                        </p:graphicImage>
                        <p:dataExporter
                            encoding="UTF-8" fileName="ObrasCompletas"
                            pageOnly="true" target="mainTable" type="xls" >
                        </p:dataExporter>
                    </h:commandLink>

                    <p:spacer width="25px" ></p:spacer>

                    <h:commandLink>  
                        <p:graphicImage
                            height="30px" width="30px"
                            value="/faces/co/edu/udea/juridicapp/util/images/download_pdf.png" > 
                        </p:graphicImage>
                        <p:dataExporter
                            encoding="UTF-8" fileName="Obras" pageOnly="true"
                            preProcessor="#{oeuvreListBean.preProcessForPDFFile}"
                            target="mainTable" type="pdf"  >
                        </p:dataExporter>
                    </h:commandLink>
                </center>
            </p:panel>
        </h:panelGrid>
    </h:form>
</ui:composition>