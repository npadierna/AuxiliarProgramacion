<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd" >

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui" >

    <h:head>
        <title>Crear Nueva Obra</title>
        <f:facet name="workCreator" >
            <script type="text/javascript"
                    src="../../../util/javascript/logOutRequestFunction.js" >
            </script>
            <script type="text/javascript"
                    src="../../../util/javascript/workCreatedFunction.js" >
            </script>
            <meta content='text/html; charset=UTF-8'
                  http-equiv="Content-Type" >
            </meta>

        </f:facet>
    </h:head>

    <h:body>
        <p:layout fullPage="true" >
            <p:layoutUnit closable="false" collapsible="false" position="south"
                          resizable="false" size="60" >
                <p:commandButton id="home"
                                 onclick="location.href = '/Juridicapp/faces/co/edu/udea/juridicapp/web/work/list/worklist.xhtml';" 
                                 value="Volver al Listado de Obras"  style="font-size:15px;" >
                </p:commandButton>
            </p:layoutUnit>
            <p:layoutUnit closable="false" collapsible="true" effect="drop"
                          header="#{updateUserBean.loggedUser.person.firstNames} #{updateUserBean.loggedUser.person.lastNames}"
                          position="north" resizable="false" size="130" >
                <h:form id="logoutAndUpdateInfoForm" >
                    <p align="center" >
                    <p:spacer height="5px" width="15px" ></p:spacer>

                    <p:commandButton onclick="location.href = '/Juridicapp/faces/co/edu/udea/juridicapp/web/user/update/updateinfouser.xhtml';"
                                     style="font-size:15px;"
                                     value="Actualizar Datos" >
                    </p:commandButton>

                    <p:spacer height="5px" width="15px" ></p:spacer>

                    <p:commandButton actionListener="#{loginUserBean.logOut}"
                                     onclick="location.href = '/Juridicapp/faces/co/edu/udea/juridicapp/web/index.xhtml';"
                                     oncomplete="handleLogoutRequest(xhr, status, args)"
                                     style="font-size:15px;"
                                     value="Cerrar Sesión" >
                    </p:commandButton>
                    </p>
                </h:form>
            </p:layoutUnit>  

            <p:layoutUnit position="center"  >
                <p:growl id="growlChangePassword" life="3000" showDetail="true" />
                <h:form id="mainForm" >
                    <p:panel header="Crear Nueva Obra" >
                        <p:wizard backLabel="Atrás" id="viewWizard"
                                  nextLabel="Siguiente"  >

                            <p:tab id="work" title="Obra" >
                                <center>
                                    <p:accordionPanel activeIndex="0,1"
                                                      multiple="true"  >
                                        <p:tab title="Datos De La Obra"  >
                                            <h:panelGrid  cellpadding="10"
                                                          columns="3" >
                                                <h:outputText
                                                    value="Nombre De La Obra:" >
                                                </h:outputText>
                                                <p:inputText id="workNameInputText"
                                                             label="Nombre de la Obra"
                                                             maxlength="55"
                                                             required="true" 
                                                             size="45"
                                                             value="#{creatorWorkBean.work.title}" >
                                                    <f:validateRegex pattern="^[ a-zA-Z0-9]+" >
                                                    </f:validateRegex>  
                                                </p:inputText>
                                                <p:watermark for="workNameInputText"
                                                             value="Nombre" >
                                                </p:watermark>

                                                <h:outputText value="Descripción:" >
                                                </h:outputText>
                                                <p:inputTextarea autoResize="false"
                                                                 cols="35"
                                                                 counter="counter"
                                                                 counterTemplate="{0} Caracteres Restantes."
                                                                 id="descriptionInputTextArea"
                                                                 maxlength="150" rows="4"
                                                                 value="#{creatorWorkBean.work.description}" >
                                                </p:inputTextarea>
                                            </h:panelGrid>
                                            <p:watermark for="descriptionInputTextArea"
                                                         value="Descripción breve de la Obra." >
                                            </p:watermark>

                                            <h:outputText id="counter" >
                                            </h:outputText>
                                        </p:tab>
                                        <p:tab title="Datos De La Dependencia" >
                                            <h:panelGrid  cellpadding="10" columns="2" >
                                                <h:outputLabel for="dependenciesNameList" 
                                                               style="font-weight:bold"
                                                               value="Nombre De La Dependencia:" >
                                                </h:outputLabel>
                                                <p:selectOneMenu id="dependenciesNameList"
                                                                 label="Nombres de Dependencias"
                                                                 required="true"
                                                                 value="#{creatorWorkBean.work.dependency.name}" >
                                                    <f:selectItems
                                                        value="#{creatorWorkBean.dependenciesNames}" >
                                                    </f:selectItems>
                                                </p:selectOneMenu>
                                            </h:panelGrid>
                                        </p:tab>
                                    </p:accordionPanel>
                                </center>
                            </p:tab>

                            <p:tab id="authors" title="Author(es)">
                                <p:panel id="authorsAdderPanel" >
                                    <center>
                                        <p:panel header="Añadir Autores"
                                                 id="authorsFinderPanel" >
                                            <h:panelGrid cellpadding="7"
                                                         columns="3" >
                                                <h:outputLabel for="authorDocumentType"
                                                               style="font-weight:bold"
                                                               value="Tipo De Documento:" >
                                                </h:outputLabel>
                                                <p:selectOneMenu id="authorDocumentType"
                                                                 label="Tipo Documento" required="true"
                                                                 value="#{creatorWorkBean.documentType}" >
                                                    <f:selectItems value="#{registrationUserBean.documentsType}" >
                                                    </f:selectItems>
                                                </p:selectOneMenu>
                                                <p:watermark for="authorDocumentType"
                                                             value="Tipo de Documento" >
                                                </p:watermark>

                                                <h:outputLabel for="authorIdNumber"
                                                               style="font-weight:bold"
                                                               value="Número De Documento:" >
                                                </h:outputLabel>
                                                <p:inputText id="authorIdNumber"
                                                             label="Número de Documento"
                                                             maxlength="20"
                                                             size="45"
                                                             value="#{creatorWorkBean.idNumber}" >
                                                </p:inputText>
                                                <p:watermark for="authorIdNumber" value="Obligatorio" >
                                                </p:watermark>
                                            </h:panelGrid>

                                            <p:commandButton actionListener="#{creatorWorkBean.findAuthor}"
                                                             id="findAuthorsButton"
                                                             update="authorsFinderPanel"
                                                             value="Buscar Author" >
                                            </p:commandButton>

                                            <p:panel id="resultsSearchingPanel" >
                                                <p:spacer height="20px" >
                                                </p:spacer>

                                                <p:dataTable emptyMessage="No se han encontrado Autores."
                                                             id="authorFoundTable"
                                                             value="#{creatorWorkBean.foundAuthors}"
                                                             var="foundAuthor" >

                                                    <p:column>
                                                        <f:facet name="header" >
                                                            <h:outputText value="Apellidos" >
                                                            </h:outputText>
                                                        </f:facet>
                                                        <h:outputText
                                                            value="#{foundAuthor.person.lastNames}" >
                                                        </h:outputText>
                                                    </p:column>

                                                    <p:column>
                                                        <f:facet name="header" >
                                                            <h:outputText value="Nombres" >
                                                            </h:outputText>
                                                        </f:facet>
                                                        <h:outputText
                                                            value="#{foundAuthor.person.firstNames}" >
                                                        </h:outputText>
                                                    </p:column>

                                                    <p:column>
                                                        <f:facet name="header" >
                                                            <h:outputText value="Número Celular" >
                                                            </h:outputText>
                                                        </f:facet>
                                                        <h:outputText
                                                            value="#{foundAuthor.mobileNumber}" >
                                                        </h:outputText>
                                                    </p:column>

                                                    <p:column>
                                                        <f:facet name="header" >
                                                            <h:outputText value="Teléfono Fijo" >
                                                            </h:outputText>
                                                        </f:facet>
                                                        <h:outputText
                                                            value="#{foundAuthor.phoneNumber}" >
                                                        </h:outputText>
                                                    </p:column>

                                                    <p:column>
                                                        <f:facet name="header" >
                                                            <h:outputText
                                                                value="Correo Electrónico" >
                                                            </h:outputText>
                                                        </f:facet>
                                                        <h:outputText
                                                            value="#{foundAuthor.person.email}" >
                                                        </h:outputText>
                                                    </p:column>

                                                    <p:column>
                                                        <center>
                                                            <p:commandButton action="#{creatorWorkBean.addAuthor(foundAuthor)}"
                                                                             id="addAuthorButton"
                                                                             update=":mainForm:authorsAdderPanel"
                                                                             value="Añadir" >
                                                            </p:commandButton>
                                                        </center>
                                                    </p:column>
                                                </p:dataTable>
                                            </p:panel>
                                        </p:panel>
                                    </center>

                                    <p:spacer height="25px" ></p:spacer>

                                    <center>
                                        <p:panel header="Autores Añadidos" id="addedAuthorsWorksPanel" >
                                            <p:dataTable emptyMessage="No se han añadido Autores."
                                                         id="addedAuthorsWorksTable"
                                                         style="font-size:15px"
                                                         value="#{creatorWorkBean.authorsWorks}"
                                                         var="authorWork" >
                                                <p:column>
                                                    <f:facet name="header" >
                                                        <h:outputText value="Tipo De Documento" >
                                                        </h:outputText>
                                                    </f:facet>
                                                    <h:outputText
                                                        value="#{authorWork.authorWorkPK.documentType}" >
                                                    </h:outputText>
                                                </p:column>

                                                <p:column>
                                                    <f:facet name="header" >
                                                        <h:outputText value="Número De Documento" >
                                                        </h:outputText>
                                                    </f:facet>
                                                    <h:outputText
                                                        value="#{authorWork.authorWorkPK.idNumber}" >
                                                    </h:outputText>
                                                </p:column>

                                                <p:column>
                                                    <f:facet name="header" >
                                                        <h:outputText value="Nombre Completo" >
                                                        </h:outputText>
                                                    </f:facet>
                                                    <h:outputText
                                                        value="#{authorWork.author.person.lastNames} #{authorWork.author.person.firstNames}" >
                                                    </h:outputText>
                                                </p:column>

                                                <p:column>
                                                    <f:facet name="header" >
                                                        <h:outputText value="Número Celular" >
                                                        </h:outputText>
                                                    </f:facet>
                                                    <h:outputText
                                                        value="#{authorWork.author.mobileNumber}" >
                                                    </h:outputText>
                                                </p:column>

                                                <p:column>
                                                    <f:facet name="header" >
                                                        <h:outputText value="Teléfono Fijo" >
                                                        </h:outputText>
                                                    </f:facet>
                                                    <h:outputText
                                                        value="#{authorWork.author.phoneNumber}" >
                                                    </h:outputText>
                                                </p:column>

                                                <p:column>
                                                    <f:facet name="header" >
                                                        <h:outputText value="Correo Electrónico" >
                                                        </h:outputText>
                                                    </f:facet>
                                                    <h:outputText
                                                        value="#{authorWork.author.person.email}" >
                                                    </h:outputText>
                                                </p:column>

                                                <p:column>
                                                    <center>
                                                        <p:commandButton id="deleteAuthorWorkButton"
                                                                         action="#{creatorWorkBean.removeAuthorWork(authorWork)}"
                                                                         update="addedAuthorsWorksTable"
                                                                         value="Eliminar" >
                                                        </p:commandButton>
                                                    </center>
                                                </p:column>
                                            </p:dataTable>
                                        </p:panel>
                                    </center>
                                </p:panel>
                            </p:tab>

                            <p:tab id="authorWork" title="Añadir Obras A Autores">
                                <center>
                                    <p:panel header="Añadir Obras A Autores"
                                             id="authorsWorksAdderPanel" >

                                        <p:dataTable emptyMessage="No se han añadido Autores."
                                                     id="addedAuthorsWorksFinalTable"
                                                     style="font-size:13px"
                                                     value="#{creatorWorkBean.authorsWorks}"
                                                     var="authorWork" >

                                            <p:column>
                                                <f:facet name="header" >
                                                    <h:outputText value="+" >
                                                    </h:outputText>
                                                </f:facet>
                                                <p:rowToggler></p:rowToggler>
                                            </p:column>

                                            <p:column>
                                                <f:facet name="header" >
                                                    <h:outputText value="Tipo De Documento" >
                                                    </h:outputText>
                                                </f:facet>
                                                <h:outputText value="#{authorWork.authorWorkPK.documentType}" >
                                                </h:outputText>
                                            </p:column>

                                            <p:column>
                                                <f:facet name="header" >
                                                    <h:outputText value="Número De Documento" >
                                                    </h:outputText>
                                                </f:facet>
                                                <h:outputText value="#{authorWork.authorWorkPK.idNumber}" >
                                                </h:outputText>
                                            </p:column>

                                            <p:column>
                                                <f:facet name="header" >
                                                    <h:outputText value="Nombre Completo" >
                                                    </h:outputText>
                                                </f:facet>
                                                <h:outputText value="#{authorWork.author.person.lastNames} #{authorWork.author.person.firstNames}" >
                                                </h:outputText>
                                            </p:column>

                                            <p:column>
                                                <f:facet name="header" >
                                                    <h:outputText value="N° Contrato" >
                                                    </h:outputText>
                                                </f:facet>
                                                <p:inputText maxlength="30" required="true" size="20"
                                                             value="#{authorWork.authorWorkPK.contract}" >
                                                </p:inputText>
                                            </p:column>

                                            <p:column>
                                                <f:facet name="header" >
                                                    <h:outputText value="Fecha De Inicio" >
                                                    </h:outputText>
                                                </f:facet>
                                                <p:calendar effect="explode" size="5"
                                                            value="#{authorWork.starting}" >
                                                </p:calendar>
                                            </p:column>

                                            <p:column>
                                                <f:facet name="header" >
                                                    <h:outputText value="Fecha De Entrega" >
                                                    </h:outputText>
                                                </f:facet>
                                                <p:calendar effect="explode" size="5"
                                                            value="#{authorWork.delivering}" >
                                                </p:calendar>
                                            </p:column>

                                            <p:column>
                                                <f:facet name="header" >
                                                    <h:outputText value="Tipo De Obra" >
                                                    </h:outputText>
                                                </f:facet>
                                                <p:selectOneMenu id="authorWorkType"
                                                                 label="Tipo de la Obra"
                                                                 required="true"
                                                                 value="#{authorWork.authorWorkPK.workTypeName}" >
                                                    <f:selectItems value="#{typeBean.typesNames}" >
                                                    </f:selectItems>
                                                </p:selectOneMenu>
                                            </p:column>

                                            <p:column>
                                                <f:facet name="header" >
                                                    <h:outputText value="Soporte De La Obra" >
                                                    </h:outputText>
                                                </f:facet>
                                                <p:selectOneMenu id="authorWorkSupport"
                                                                 label="Soporte de la Obra"
                                                                 required="true"
                                                                 value="#{authorWork.supportType.type}" >
                                                    <f:selectItems value="#{supportBean.supportsNames}" >
                                                    </f:selectItems>
                                                </p:selectOneMenu>
                                            </p:column>

                                            <p:column>
                                                <f:facet name="header" >
                                                    <h:outputText value="Vínculo Con La Universidad" >
                                                    </h:outputText>
                                                </f:facet>
                                                <p:selectOneMenu id="authorWorkRole"
                                                                 label="Vínculo con Universidad"
                                                                 required="true"
                                                                 value="#{authorWork.role.profile}" >
                                                    <f:selectItems value="#{roleBean.rolesNames}" >
                                                    </f:selectItems>
                                                </p:selectOneMenu>
                                            </p:column>

                                            <p:rowExpansion >
                                                <center>
                                                    <p:spacer height="10px" ></p:spacer>
                                                    <h:panelGrid cellpadding="7" columns="6"
                                                                 style="font-size:15px" >
                                                        <h:outputText value="ISBN:" >
                                                        </h:outputText>
                                                        <p:inputText id="authorWorkISBN" maxlength="35"
                                                                     required="false" size="35"
                                                                     value="#{authorWork.isbn}" >
                                                        </p:inputText>
                                                        <p:watermark for="authorWorkISBN"
                                                                     value="Opcional" >
                                                        </p:watermark>

                                                        <h:outputText value="DNDA:" >
                                                        </h:outputText>
                                                        <p:inputText id="authorWorkDNDA" maxlength="30"
                                                                     required="false" size="30"
                                                                     value="#{authorWork.dnda}" >
                                                        </p:inputText>
                                                        <p:watermark for="authorWorkDNDA"
                                                                     value="Opcional" >
                                                        </p:watermark>
                                                    </h:panelGrid>
                                                    <p:spacer height="10px" ></p:spacer>
                                                </center>
                                            </p:rowExpansion>
                                        </p:dataTable>
                                    </p:panel>
                                </center>
                            </p:tab>


                            <p:tab id="coments" title="Observaciones" >
                                <p:panel header="Añadir Comentarios"
                                         id="adderCommentsPanel" >
                                    <center>
                                        <h:panelGrid cellpadding="10" columns="2"
                                                     id="commentTyperPanelGrid" >
                                            <h:outputText value="Observaciones o comentarios:" >
                                            </h:outputText>
                                            <p:inputTextarea autoResize="false" cols="30"
                                                             counter="counterComents"
                                                             counterTemplate="{0} Caracteres Restantes."
                                                             maxlength="150" rows="5"
                                                             value="#{creatorWorkBean.commentText}" >
                                            </p:inputTextarea>
                                        </h:panelGrid>
                                        <h:outputText id="counterComents" >
                                        </h:outputText>
                                    </center>
                                    <center>
                                        <p:commandButton actionListener="#{creatorWorkBean.addComment}"
                                                         id="addCommentButton"
                                                         update=":mainForm:adderCommentsPanel"
                                                         value="Añadir Comentario" >
                                        </p:commandButton>
                                    </center>

                                    <p:panel id="addCommentsPanel" >
                                        <p:spacer height="20px" ></p:spacer>

                                        <p:dataTable emptyMessage="No se han añadido Comentarios."
                                                     id="addCommentsTable"
                                                     value="#{creatorWorkBean.comments}"
                                                     var="comment" >
                                            <p:column>
                                                <f:facet name="header" >
                                                    <h:outputText value="Texto De Comentario" >
                                                    </h:outputText>
                                                </f:facet>
                                                <h:outputText
                                                    value="#{comment.text}" >
                                                </h:outputText>
                                            </p:column>

                                            <p:column>
                                                <f:facet name="header" >
                                                    <h:outputText value="Fecha / Hora" >
                                                    </h:outputText>
                                                </f:facet>
                                                <h:outputText
                                                    value="#{comment.dateTime}" >
                                                </h:outputText>
                                            </p:column>

                                            <p:column>
                                                <center>
                                                    <p:commandButton action="#{creatorWorkBean.removeComment(comment)}"
                                                                     id="removeCommentButton"
                                                                     update="addCommentsTable"
                                                                     value="Eliminar" >
                                                    </p:commandButton>
                                                </center>
                                            </p:column>
                                        </p:dataTable>
                                    </p:panel>
                                </p:panel>
                            </p:tab>

                            <!--p:tab id="file" title="Archivos" >
                                <center>
                                    <h:panelGrid cellpadding="10" columns="2" >
                                        <h:outputText value="Archivo(s)" >
                                        </h:outputText>
                                        <p:fileUpload allowTypes="/(\.|\/)(gif|jpe?g|png)$/"
                                                      dragDropSupport="true" 
                                                      cancelLabel="Cancelar" 
                                                      label="Adjuntar"
                                                      mode="advanced"
                                                      sizeLimit="512000" 
                                                      uploadLabel="Subir" >
                                        </p:fileUpload>                                 
                                    </h:panelGrid>
                                </center>
                            </p:tab-->

                            <p:tab id="confirmation" title="Confirmación" >
                                <center>
                                    <p:dataTable draggableColumns="true"
                                                 id="mainTable"
                                                 style="width:98%; font-size:13px;"
                                                 value="#{creatorWorkBean.authorsWorks}"
                                                 var="authorWork" > 

                                        <f:facet name="header" >
                                            Obras Creadas
                                        </f:facet>

                                        <p:column 
                                            style="font-size:15px;" >
                                            <f:facet id="issue" name="header" >
                                                <h:outputText value="Nombre De La Obra" >
                                                </h:outputText>  
                                            </f:facet>
                                            <h:outputText style="font-size:13px;"
                                                          value="#{creatorWorkBean.work.title}" >
                                            </h:outputText>
                                        </p:column>

                                        <p:column 
                                            style="font-size:15px;" >
                                            <f:facet id="year" name="header" >
                                                <h:outputText
                                                    value="Fecha De Entrega" >
                                                </h:outputText>  
                                            </f:facet>
                                            <center>
                                                <h:outputText style="font-size:13px;"
                                                              value="#{authorWork.delivering}" >
                                                </h:outputText>
                                            </center>
                                        </p:column>

                                        <p:column 
                                            style="font-size:15px;" >
                                            <f:facet id="type" name="header">  
                                                <h:outputText value="Tipo" >
                                                </h:outputText>  
                                            </f:facet>
                                            <h:outputText style="font-size:13px;"
                                                          value="#{authorWork.authorWorkPK.workTypeName}" >
                                            </h:outputText>
                                        </p:column>

                                        <p:column 
                                            style="font-size:15px;" >
                                            <f:facet id="author" name="header" >
                                                <h:outputText value="Autor" >
                                                </h:outputText>  
                                            </f:facet>
                                            <h:outputText style="font-size:13px;"
                                                          value="#{authorWork.author.person.lastNames} #{authorWork.author.person.firstNames}" >
                                            </h:outputText>
                                        </p:column>

                                        <p:column 
                                            style="font-size:15px;" >
                                            <f:facet id="contract" name="header" > 
                                                <h:outputText value="N° Contrato" >
                                                </h:outputText> 
                                            </f:facet>
                                            <center>
                                                <h:outputText style="font-size:13px;"
                                                              value="#{authorWork.authorWorkPK.contract}" >
                                                </h:outputText>
                                            </center>
                                        </p:column>

                                        <p:column style="font-size:15px;" >
                                            <f:facet id="isbn" name="header" > 
                                                <h:outputText value="ISBN" >
                                                </h:outputText>
                                            </f:facet>
                                            <center>
                                                <h:outputText style="font-size:13px;"
                                                              value="#{authorWork.isbn}" >
                                                </h:outputText>
                                            </center>
                                        </p:column>

                                        <p:column 
                                            style="font-size:15px;" >
                                            <f:facet id="dnda" name="header" >
                                                <h:outputText value="DNDA" >
                                                </h:outputText>  
                                            </f:facet>
                                            <center>
                                                <h:outputText style="font-size:13px;"
                                                              value="#{authorWork.dnda.number}" >
                                                </h:outputText>
                                            </center>
                                        </p:column>

                                        <p:column 
                                            style="font-size:15px;" >
                                            <f:facet id="support" name="header" >
                                                <h:outputText value="Soporte" >
                                                </h:outputText>  
                                            </f:facet>
                                            <center>
                                                <h:outputText style="font-size:13px;"
                                                              value="#{authorWork.supportType.type}" >
                                                </h:outputText>
                                            </center>
                                        </p:column>
                                        <f:facet  id="obras" name="footer" ></f:facet>
                                    </p:dataTable>
                                    <p:commandButton id="save" icon="ui-icon-disk" 
                                                     value="Guardar" 
                                                     
                                                     oncomplete="handleWorkCreatedRequest(xhr, status, args)">
                                    </p:commandButton>
                                </center>
                            </p:tab>                            
                        </p:wizard>
                    </p:panel>
                </h:form>
            </p:layoutUnit>
        </p:layout>
    </h:body>
</html>